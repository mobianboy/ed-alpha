!function(balls){balls.file={typeAuth:function(fileExt,mimeType){var fileExt=fileExt?fileExt.toLowerCase():null,mimeType=mimeType?mimeType.toLowerCase():null,audioFileExts=["mp3","ogg","oga","wav","mp4","m4a","mp4a","aiff","aif"],audioMimes=["audio/flac","audio/ogg","audio/mp3","audio/mp4","audio/mpeg","audio/wav","audio/x-aiff","audio/x-m4a"],imageFileExts=["jpg","jpeg","png","svg","tiff","gif","bmp"],imageMimes=["image/jpg","image/jpeg","image/png","image/tiff","image/gif","image/bpm"],fileType="";return fileExt?mimeType?(fileType=audioFileExts.inArray(fileExt)&&audioMimes.inArray(mimeType)?"audio":fileType,fileType="audio"!==fileType&&imageFileExts.inArray(fileExt)&&imageMimes.inArray(mimeType)?"image":fileType,""===fileType&&balls.file.fail("Wrong file extention or mime type.<br />------Your File------<br />File Extention: "+fileExt+"<br />File Mime type: "+mimeType),""!==fileType?fileType:!1):"No Mime Type":"No File Extension"},upload:function(){var file=arguments[0]?arguments[0]:null,ownerOfFileId=arguments[1]?arguments[1]:null,uploadType=arguments[2]&&"function"!=typeof arguments[2]?arguments[2]:null,callBack=arguments[2]&&"function"==typeof arguments[2]?arguments[2]:null,callBack=arguments[3]&&"function"==typeof arguments[3]?arguments[3]:callBack,xhr=new XMLHttpRequest,name=file.name.toString(),fileExt=name.substring(name.lastIndexOf(".")+1,name.length),fileType=this.typeAuth(fileExt,file.type);if(fileType===!1)return"Bad file extention or mime type";var progress=$("<div class='progress'><div class='bar'></div><span></span></div>");if("block"==$(".profileImageUploadWashout").css("display")?$(".profileImageUploadWashout").find(".profileImageUpload .wrapper").append(progress):($("section.contribute .dropZone").append(progress),progress.find("span").append("Media: "+file.name)),xhr.upload.addEventListener("progress",function(e){var pc=parseInt(100*(e.loaded/e.total),10);(90>pc||pc>99)&&progress.find(".bar").css("width",pc+"%")},!1),xhr.onreadystatechange=function(){4==xhr.readyState&&(200==xhr.status?(progress.html("Upload complete!"),setTimeout(function(){progress.remove(),callBack(xhr.responseText)},1e3)):(balls.file.fail("Unknown Server Error. Please try again in a moment.",xhr),callBack(!1)))},xhr.upload&&null!=file){var formData=new FormData;formData.append("mfp_upload",file),formData.append("data",JSON.stringify({format:fileType,type:uploadType,id:ownerOfFileId})),xhr.open("POST","http://"+userSession.mfpServer+"/upload"),xhr.send(formData)}else balls.file.fail("file is null or xhr.upload isn't available");return xhr},fail:function(text,xhr){balls.state.fluffer("stop"),balls.error(text+" - Please see console for more"),console.log(xhr)}}}(window.balls);